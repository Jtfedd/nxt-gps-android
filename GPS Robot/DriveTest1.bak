int drivePower = 0;
int steer = 0;

bool powerSelected = true;

task drive() {
  while(true) {
    if (drivePower <= 0) {
      OnRev(OUT_ABC, -drivePower);
      continue;
    }
    
    int left = 100;
    if (steer < 0) {
      left += steer / 2;
    }
    
    int right = 100;
    if (steer > 0) {
      right -= steer / 2;
    }
    
    left = (left * drivePower) / 100;
    right = (right * drivePower) / 100;
    
    int ave = (left + right) / 2;
    
    OnFwd(OUT_A, left);
    OnFwd(OUT_B, right);
    OnFwd(OUT_C, ave);
  }
}

task main() {
  start drive;
  while(true) {
    ClearScreen();
    
    NumOut(70, LCD_LINE1, drivePower);
    NumOut(70, LCD_LINE2, steer);
    
    if (powerSelected) {
      TextOut(0, LCD_LINE1, "Power");
      TextOut(0, LCD_LINE2, "steer");
    } else {
      TextOut(0, LCD_LINE1, "power");
      TextOut(0, LCD_LINE2, "Steer");
    }
    
    if (ButtonPressed(BTNLEFT, FALSE)) {
      if (powerSelected) {
        drivePower -= 5;
        if (drivePower < -100) drivePower = -100;
      } else {
        steer -= 5;
        if (steer < -100) steer = -100;
      }
    }
    
    if (ButtonPressed(BTNRIGHT, FALSE)) {
      if (powerSelected) {
        drivePower += 5;
        if (drivePower > 100) drivePower = 100;
      } else {
        steer += 5;
        if (steer > 100) steer = 100;
      }
    }
    
    if (ButtonPressed(BTNCENTER, FALSE)) {
      until(!ButtonPressed(BTNCENTER, FALSE));
      powerSelected = !powerSelected;
    }

    Wait(100);
  }
}
